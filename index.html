<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ù„Ù€ÙˆØ­Ù€Ø© ØªÙ€Ø­Ù€ÙƒÙ€Ù… Ø§Ù„Ù€Ø¨Ù€ÙˆØª</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');

        body {
            font-family: 'Cairo', sans-serif;
            background-color: #0f0f0f;
            color: #f2f2f2;
            padding: 20px;
            font-size: 1.1rem;
        }

        .channel-card, .bot-status, .add-channel-card, .rules-card, .summary-card {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 25px;
            border: 1px solid #333;
            box-shadow: 0 0 10px #ff6f0055;
        }

        h5 {
            font-weight: 700;
            font-size: 1.5rem;
            color: #ff6f00;
            margin-bottom: 15px;
            text-shadow: 0 0 8px #ff6f00aa;
        }

        .channel-id {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .tag-badge {
            background-color: #2a2a2a;
            color: #ff6f00;
            padding: 10px 18px;
            margin: 8px;
            border-radius: 28px;
            display: inline-flex;
            align-items: center;
            font-weight: 600;
            font-size: 1.15rem;
            user-select: none;
        }

            .tag-badge span.remove-tag {
                margin-left: 20px;
                background-color: #bf0e0e; /* Ø£Ø­Ù…Ø± */
                border-radius: 50%;
                padding: 6px 12px;
                font-size: 18px;
                cursor: pointer;
                line-height: 1;
                font-weight: bold;
                user-select: none;
                transition: background-color 0.3s ease;
            }

                .tag-badge span.remove-tag:hover {
                    background-color: #ff3d00;
                }

        .banned-tag {
            background-color: #420e0e; /* Ø±Ù…Ø§Ø¯ÙŠ Ø¹Ù„Ù‰ Ø£Ø³ÙˆØ¯ */
            color: #adadad;
            padding: 10px 18px;
            margin: 8px;
            border-radius: 28px;
            display: inline-flex;
            align-items: center;
            font-weight: 600;
            font-size: 1.15rem;
            user-select: none;
        }

            .banned-tag span.remove-tag {
                margin-left: 20px;
                background-color: #d32f2f;
                border-radius: 50%;
                padding: 6px 12px;
                font-size: 18px;
                cursor: pointer;
                line-height: 1;
                font-weight: bold;
                user-select: none;
                transition: background-color 0.3s ease;
            }

                .banned-tag span.remove-tag:hover {
                    background-color: #ff3d00;
                }

        input.form-control {
            background: #111;
            border: 1px solid #444;
            color: #f2f2f2;
            border-radius: 10px;
            margin-bottom: 10px;
            font-size: 1.1rem;
            padding: 10px 14px;
        }

        .banned-input {
            color: #ddd;
            background-color: #222;
            border-color: #444;
        }

        button.btn {
            font-weight: bold;
            border-radius: 10px;
            margin-left: 10px;
            font-size: 1.1rem;
        }

        .delete-channel {
            margin-top: 12px;
            border-radius: 10px;
            font-weight: bold;
            width: 100%;
            font-size: 1.2rem;
        }

        footer {
            margin-top: 60px;
            padding-top: 20px;
            border-top: 1px solid #333;
            text-align: center;
            color: #ccc;
            font-size: 1rem;
        }

            footer a {
                color: #ffa040;
                font-weight: bold;
                text-decoration: none;
                transition: color 0.3s ease;
            }

                footer a:hover {
                    color: #ffc270;
                    text-decoration: underline;
                }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: #ff6f00aa;
            border-radius: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        /* Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø§Ù„Ø±ÙˆÙ„Ø§Øª */
        .add-role-section {
            margin-top: 15px;
        }

            .add-role-section input {
                margin-bottom: 8px;
            }
    </style>
</head>
<body>
    <div class="container">

        <div class="bot-status d-flex justify-content-between align-items-center">
            <div>
                <h5>ğŸ–¥ï¸ Ø­Ù€Ø§Ù„Ù€Ø© Ø§Ù„Ù€Ø¨Ù€ÙˆØª : <span id="bot-status-text" class="text-success">Ø¬Ù€Ø§Ø±ÙŠ Ø§Ù„Ù€ØªÙ€Ø­Ù€Ù…Ù€ÙŠÙ€Ù„...</span></h5>
                <small>â± Ù…Ù€Ø¯Ø© Ø§Ù„Ù€ØªÙ€Ø´Ù€ØºÙ€ÙŠÙ€Ù„ : <span id="uptime">0 Ø«Ù€Ø§Ù†Ù€ÙŠÙ€Ø©</span></small>
            </div>
            <div>
                <button class="btn btn-danger" id="stop-bot">ğŸ”´ Ø¥ÙŠÙ€Ù‚Ù€Ø§Ù Ø§Ù„Ù€Ø¨Ù€ÙˆØª </button>
                <button class="btn btn-success" id="start-bot">ğŸŸ¢ ØªÙ€Ø´Ù€ØºÙ€ÙŠÙ€Ù„ Ø§Ù„Ù€Ø¨Ù€ÙˆØª </button>
            </div>
        </div>
    </div>

        <!-- Ø±ÙˆÙ… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
        <div class="summary-card">
            <h5>ğŸ“¢ Ø±ÙˆÙ… Ø§Ù„Ù€ØªÙ€Ù‚Ù€Ø§Ø±ÙŠÙ€Ø± </h5>
            <input type="text" id="summary-name" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ø±ÙˆÙ…" />
            <input type="text" id="summary-input" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ID Ø§Ù„Ø±ÙˆÙ…" />
            <button class="btn btn-warning" onclick="updateSummaryChannel()">Ø­ÙØ¸</button>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø±ÙˆÙ…Ø§Øª -->
        <div id="channels-section"></div>

        <!-- Ø¥Ø¶Ø§ÙØ© Ø±ÙˆÙ… Ø¬Ø¯ÙŠØ¯ -->
        <div class="add-channel-card">
            <h5>â• Ø¥Ø¥Ø¶Ù€Ø§ÙÙ€Ø© Ø±ÙˆÙ… Ø¬Ù€Ø¯ÙŠÙ€Ø¯</h5>
            <input id="new-channel-id" class="form-control" placeholder="ID Ø§Ù„Ø±ÙˆÙ…" />
            <input id="new-channel-name" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ø±ÙˆÙ…" />
            <input id="new-channel-tags" class="form-control" placeholder="ØªØ§Ù‚Ø§Øª (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©)" />
            <button class="btn btn-warning" onclick="addChannel()">Ø¥Ø¶Ø§ÙØ© Ø±ÙˆÙ… Ø¬Ø¯ÙŠØ¯</button>
        </div>

        <!-- Ø§Ù„ØªØ§Ù‚Ø§Øª Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© -->
        <div class="channel-card">
            <h5>ğŸš« Ø§Ù„Ù€ØªÙ€Ø§Ù‚Ù€Ø§Øª Ø§Ù„Ù€Ù…Ù€Ø­Ù€Ø¸Ù€ÙˆØ±Ø© Ø§Ù„Ù€Ø¹Ù€Ø§Ù…Ù€Ø©:</h5>
            <div id="banned-tags"></div>
            <input id="banned-input" class="form-control banned-input" placeholder="Ø£Ø¶Ù ØªØ§Ù‚ Ù…Ø­Ø¸ÙˆØ±..." />
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø±ÙˆÙ„Ø§Øª -->
        <div class="rules-card">
            <h5>ğŸ›ï¸ ØªÙ€Ø¹Ù€Ø¯ÙŠÙ€Ù„ Ø§Ù„Ù€Ø±ÙˆÙ„Ù€Ø§Øª</h5>
            <div id="rules-section"></div>
        </div>

        <footer>
            <div class="footer-brand" style="color: #ff6f00; font-size: 24px; font-weight: bold;">
                âš¡ Ù„Ù€ÙˆØ­Ù€Ø© ØªÙ€Ø­Ù€ÙƒÙ€Ù… Ø§Ù„Ù€Ø¨Ù€ÙˆØª | <span>ğğ‹ğ€ğ‚ğŠ ğ‹ğˆğ’ğ“ ğƒğ€ğ’ğ‡ğğğ€ğ‘ğƒ</span>
            </div>
                <div class="footer-credit">
                    ØªÙ€Ù… ØªÙ€Ø·Ù€ÙˆÙŠÙ€Ø± Ø¨Ù€ÙƒÙ€Ù„ <span style="color:#ff6f00;">â¤ï¸</span> Ø¨Ù€ÙˆØ§Ø³Ù€Ø·Ù€Ø©
                    <a href="https://discord.com/users/1324828948843991200" target="_blank">ğ—Ÿğ—¢ğ—¥ğ——</a>
                    <span>â€”   Ø¬Ù€Ù…Ù€ÙŠÙ€Ø¹ Ø§Ù„Ù€Ø­Ù€Ù‚Ù€ÙˆÙ‚ Ù…Ù€Ø­Ù€ÙÙ€ÙˆØ¸Ù€Ø© Â© 2025</span>
                </div>
</footer>
        <script>
            // Ù…ØªØºÙŠØ±Ø§Øª Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ù‚ØªØ§Ù‹
            let configData = null;
            let rulesData = null;

            // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª config.json Ùˆ rule.json Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            async function fetchData() {
                const configResp = await fetch('/config.json');
                configData = await configResp.json();

                const rulesResp = await fetch('/api/rules');
                rulesData = await rulesResp.json();

                renderChannels();
                renderBannedTags();
                renderSummaryChannel();
                renderRules();
                fetchBotStatus();
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙˆÙ…Ø§Øª Ù…Ù† config.channels
            function renderChannels() {
                const container = document.getElementById('channels-section');
                container.innerHTML = '<h5>ğŸ“ Ø§Ù„Ù€Ø±ÙˆÙ…Ù€Ø§Øª</h5>';

                for (const id in configData.channels) {
                    const ch = configData.channels[id];

                    const card = document.createElement('div');
                    card.className = 'channel-card';

                    // Ø§Ø³Ù… Ø§Ù„Ø±ÙˆÙ… Ùˆ ID
                    const title = document.createElement('h5');
                    title.textContent = ch.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';
                    card.appendChild(title);

                    const idText = document.createElement('div');
                    idText.className = 'channel-id';
                    idText.textContent = `ID: ${id}`;
                    card.appendChild(idText);

                    // Ø§Ù„ØªØ§Ù‚Ø§Øª
                    const tagsTitle = document.createElement('div');
                    tagsTitle.textContent = 'ğŸ·ï¸ Ø§Ù„ØªØ§Ù‚Ø§Øª:';
                    card.appendChild(tagsTitle);

                    const tagsContainer = document.createElement('div');
                    (ch.tags || []).forEach(tag => {
                        tagsContainer.appendChild(createTagElement(tag, async (t) => {
                            await removeTagFromChannel(id, t, false);
                        }));
                    });
                    card.appendChild(tagsContainer);

                    // Ø§Ù„ØªØ§Ù‚Ø§Øª Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø±ÙˆÙ…
                    const bannedTitle = document.createElement('div');
                    bannedTitle.style.marginTop = '10px';
                    bannedTitle.textContent = 'ğŸš« Ø§Ù„ØªØ§Ù‚Ø§Øª Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø© Ø§Ù„Ø®Ø§ØµØ©:';
                    card.appendChild(bannedTitle);

                    const bannedContainer = document.createElement('div');
                    (ch.bannedTags || []).forEach(tag => {
                        bannedContainer.appendChild(createBannedTagElement(tag, async (t) => {
                            await removeTagFromChannel(id, t, true);
                        }));
                    });
                    card.appendChild(bannedContainer);

                    // Ø¥Ø¶Ø§ÙØ© ØªØ§Ù‚ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø±ÙˆÙ…
                    const input = document.createElement('input');
                    input.className = 'form-control';
                    input.placeholder = 'Ø£Ø¶Ù ØªØ§Ù‚...';
                    input.style.marginTop = '8px';
                    card.appendChild(input);

                    const addBtn = document.createElement('button');
                    addBtn.className = 'btn btn-warning mt-2';
                    addBtn.textContent = 'Ø¥Ø¶Ø§ÙØ© ØªØ§Ù‚';
                    addBtn.onclick = async () => {
                        const newTag = input.value.trim();
                        if (!newTag) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ù‚ ØµØ­ÙŠØ­');
                        await addTagToChannel(id, newTag, false);
                        input.value = '';
                    };
                    card.appendChild(addBtn);

                    // Ø¥Ø¶Ø§ÙØ© ØªØ§Ù‚ Ù…Ø­Ø¸ÙˆØ± Ø®Ø§Øµ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø±ÙˆÙ…
                    const inputBanned = document.createElement('input');
                    inputBanned.className = 'form-control banned-input';
                    inputBanned.placeholder = 'Ø£Ø¶Ù ØªØ§Ù‚ Ù…Ø­Ø¸ÙˆØ± Ø®Ø§Øµ...';
                    inputBanned.style.marginTop = '12px';
                    card.appendChild(inputBanned);

                    const addBannedBtn = document.createElement('button');
                    addBannedBtn.className = 'btn btn-danger mt-2';
                    addBannedBtn.textContent = 'Ø¥Ø¶Ø§ÙØ© ØªØ§Ù‚ Ù…Ø­Ø¸ÙˆØ± Ø®Ø§Øµ';
                    addBannedBtn.onclick = async () => {
                        const newTag = inputBanned.value.trim();
                        if (!newTag) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ù‚ Ù…Ø­Ø¸ÙˆØ± ØµØ­ÙŠØ­');
                        await addTagToChannel(id, newTag, true);
                        inputBanned.value = '';
                    };
                    card.appendChild(addBannedBtn);

                    // Ø²Ø± Ø­Ø°Ù Ø§Ù„Ø±ÙˆÙ…
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'btn btn-danger delete-channel';
                    deleteBtn.textContent = 'Ø­Ø°Ù Ø§Ù„Ø±ÙˆÙ…';
                    deleteBtn.onclick = async () => {
                        if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø±ÙˆÙ… "${ch.name}"ØŸ`)) {
                            await deleteChannel(id);
                        }
                    };
                    card.appendChild(deleteBtn);

                    container.appendChild(card);
                }
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± ØªØ§Ù‚ Ù…Ø¹ Ø²Ø± Ø­Ø°Ù
            function createTagElement(tag, onRemove) {
                const span = document.createElement('span');
                span.className = 'tag-badge';
                span.textContent = tag;

                const removeSpan = document.createElement('span');
                removeSpan.className = 'remove-tag';
                removeSpan.textContent = 'Ã—';
                removeSpan.title = 'Ø­Ø°Ù Ø§Ù„ØªØ§Ù‚';
                removeSpan.onclick = () => onRemove(tag);

                span.appendChild(removeSpan);
                return span;
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± ØªØ§Ù‚ Ù…Ø­Ø¸ÙˆØ± Ø®Ø§Øµ Ù…Ø¹ Ø²Ø± Ø­Ø°Ù
            function createBannedTagElement(tag, onRemove) {
                const span = document.createElement('span');
                span.className = 'banned-tag';
                span.textContent = tag;

                const removeSpan = document.createElement('span');
                removeSpan.className = 'remove-tag';
                removeSpan.textContent = 'Ã—';
                removeSpan.title = 'Ø­Ø°Ù Ø§Ù„ØªØ§Ù‚ Ø§Ù„Ù…Ø­Ø¸ÙˆØ±';
                removeSpan.onclick = () => onRemove(tag);

                span.appendChild(removeSpan);
                return span;
            }

          
            // Ø­Ø°Ù ØªØ§Ù‚ Ù…Ù† Ø±ÙˆÙ… (Ø¹Ø§Ø¯ÙŠ Ø£Ùˆ Ù…Ø­Ø¸ÙˆØ±)
            async function removeTagFromChannel(channelId, tag, banned) {
                try {
                    if (banned) {
                        const resp = await fetch(`/api/channel-banned/${channelId}`);
                        let bannedTags = await resp.json();
                        bannedTags = bannedTags.filter(t => t !== tag);

                        await fetch(`/api/channel-banned/${channelId}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ bannedTags }),
                        });
                    } else {
                        const ch = configData.channels[channelId];
                        if (!ch) return alert('Ø§Ù„Ø±ÙˆÙ… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');

                        const updatedTags = (ch.tags || []).filter(t => t !== tag);

                        await fetch(`/api/channels/${channelId}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ name: ch.name, tags: updatedTags }),
                        });
                    }

                    await reloadData();
                } catch (e) {
                    alert('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù');
                }
            }
            // Ø¥Ø¶Ø§ÙØ© ØªØ§Ù‚ Ù„Ø±ÙˆÙ…
            async function addTagToChannel(channelId, tag, banned) {
                try {
                    if (banned) {
                        const resp = await fetch(`/api/channel-banned/${channelId}`);
                        const bannedTags = await resp.json();
                        if (bannedTags.includes(tag)) return alert('Ø§Ù„ØªØ§Ù‚ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§');
                        bannedTags.push(tag);
                        await fetch(`/api/channel-banned/${channelId}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ bannedTags }),
                        });
                    } else {
                        const ch = configData.channels[channelId];
                        if ((ch.tags || []).includes(tag)) return alert('Ø§Ù„ØªØ§Ù‚ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§');
                        const newTags = (ch.tags || []).concat(tag);
                        await fetch(`/api/channels/${channelId}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ name: ch.name, tags: newTags }),
                        });
                    }
                    await reloadData();
                } catch (e) {
                    alert('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙØ©');
                }
            }

            // Ø­Ø°Ù Ø±ÙˆÙ…
            async function deleteChannel(id) {
                try {
                    await fetch(`/api/channels/${id}`, { method: 'DELETE' });
                    await reloadData();
                } catch {
                    alert('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø±ÙˆÙ…');
                }
            }

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            async function reloadData() {
                await fetchData();
            }

            // Ø¥Ø¶Ø§ÙØ© Ø±ÙˆÙ… Ø¬Ø¯ÙŠØ¯
            async function addChannel() {
                const id = document.getElementById('new-channel-id').value.trim();
                const name = document.getElementById('new-channel-name').value.trim();
                const tagsStr = document.getElementById('new-channel-tags').value.trim();
                if (!id || !name) return alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© ID ÙˆØ§Ø³Ù… Ø§Ù„Ø±ÙˆÙ…');
                const tags = tagsStr ? tagsStr.split(',').map(t => t.trim()).filter(t => t) : [];
                try {
                    await fetch('/api/channels', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ id, name, tags }),
                    });
                    document.getElementById('new-channel-id').value = '';
                    document.getElementById('new-channel-name').value = '';
                    document.getElementById('new-channel-tags').value = '';
                    await reloadData();
                } catch {
                    alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ÙˆÙ…');
                }
            }

            // Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ù‚Ø§Øª Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
            function renderBannedTags() {
                const container = document.getElementById('banned-tags');
                container.innerHTML = '';
                (configData.bannedTags || []).forEach(tag => {
                    const span = document.createElement('span');
                    span.className = 'banned-tag';
                    span.textContent = tag;

                    const removeSpan = document.createElement('span');
                    removeSpan.className = 'remove-tag';
                    removeSpan.textContent = 'Ã—';
                    removeSpan.title = 'Ø­Ø°Ù Ø§Ù„ØªØ§Ù‚ Ø§Ù„Ù…Ø­Ø¸ÙˆØ±';
                    removeSpan.onclick = async () => {
                        await removeBannedTag(tag);
                    };

                    span.appendChild(removeSpan);
                    container.appendChild(span);
                });
            }

            // Ø­Ø°Ù ØªØ§Ù‚ Ù…Ø­Ø¸ÙˆØ± Ø¹Ø§Ù…
            async function removeBannedTag(tag) {
                try {
                    const newList = (configData.bannedTags || []).filter(t => t !== tag);
                    await fetch('/api/banned', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ bannedTags: newList }),
                    });
                    await reloadData();
                } catch {
                    alert('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªØ§Ù‚ Ø§Ù„Ù…Ø­Ø¸ÙˆØ±');
                }
            }

            // Ø¥Ø¶Ø§ÙØ© ØªØ§Ù‚ Ù…Ø­Ø¸ÙˆØ± Ø¹Ø§Ù…
            document.getElementById('banned-input').addEventListener('keydown', async (e) => {
                if (e.key === 'Enter') {
                    const val = e.target.value.trim();
                    if (!val) return;
                    if ((configData.bannedTags || []).includes(val)) {
                        alert('Ø§Ù„ØªØ§Ù‚ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                        return;
                    }
                    const newList = (configData.bannedTags || []).concat(val);
                    try {
                        await fetch('/api/banned', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ bannedTags: newList }),
                        });
                        e.target.value = '';
                        await reloadData();
                    } catch {
                        alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ù‚');
                    }
                }
            });

            // âœ… Ø¹Ø±Ø¶ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø±ÙˆÙ… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ø¹Ø¯ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ù†ÙŠØ©
            function renderSummaryChannel() {
                const summary = configData.summaryChannel || {};
                document.getElementById('summary-name').value = summary.name || '';
                document.getElementById('summary-input').value = summary.id || '';
            }

            async function updateSummaryChannel() {
                const name = document.getElementById('summary-name').value.trim();
                const id = document.getElementById('summary-input').value.trim();

                if (!id) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ID Ø±ÙˆÙ… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±');

                try {
                    configData.summaryChannel = { id, name };

                    await fetch('/api/summary-channel', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            summaryChannel: id,
                            summaryChannelName: name
                        }),
                    });

                    alert('ØªÙ… Ø­ÙØ¸ Ø±ÙˆÙ… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±');
                    await reloadData();
                } catch {
                    alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø±ÙˆÙ… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±');
                }
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙˆÙ„Ø§Øª Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ø­Ø°Ù ÙˆØ§Ù„Ø¥Ø¶Ø§ÙØ© Ù„ÙƒÙ„ Ø£Ù…Ø±
            function renderRules() {
                const container = document.getElementById('rules-section');
                container.innerHTML = '';

                for (const command in rulesData) {
                    const roles = rulesData[command];

                    const card = document.createElement('div');
                    card.className = 'channel-card';

                    const title = document.createElement('h5');
                    title.textContent = `ğŸ” ØµÙ„Ø§Ø­ÙŠØ§Øª Ø£Ù…Ø± ${command}`;
                    card.appendChild(title);

                    // Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙˆÙ„Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    roles.forEach(role => {
                        const span = document.createElement('span');
                        span.className = 'tag-badge';
                        span.textContent = role.name;

                        const removeSpan = document.createElement('span');
                        removeSpan.className = 'remove-tag';
                        removeSpan.textContent = 'Ã—';
                        removeSpan.title = 'Ø­Ø°Ù Ø§Ù„Ø±ÙˆÙ„';
                        removeSpan.onclick = async () => {
                            await removeRoleFromCommand(command, role.id);
                        };

                        span.appendChild(removeSpan);
                        card.appendChild(span);
                    });

                    // Ù‚Ø³Ù… Ø¥Ø¶Ø§ÙØ© Ø±ÙˆÙ„ Ø¬Ø¯ÙŠØ¯ ØªØ­Øª ÙƒÙ„ Ø£Ù…Ø±
                    const addSection = document.createElement('div');
                    addSection.className = 'add-role-section';

                    const inputId = document.createElement('input');
                    inputId.className = 'form-control';
                    inputId.placeholder = 'Ø£Ø¯Ø®Ù„ ID Ø§Ù„Ø±ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯';
                    addSection.appendChild(inputId);

                    const inputName = document.createElement('input');
                    inputName.className = 'form-control';
                    inputName.placeholder = 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø±ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯';
                    addSection.appendChild(inputName);

                    const addBtn = document.createElement('button');
                    addBtn.className = 'btn btn-warning mt-2';
                    addBtn.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø±ÙˆÙ„ Ø¬Ø¯ÙŠØ¯';
                    addBtn.onclick = async () => {
                        const newId = inputId.value.trim();
                        const newName = inputName.value.trim();
                        if (!newId || !newName) return alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© ID ÙˆØ§Ø³Ù… Ø§Ù„Ø±ÙˆÙ„');
                        await addRoleToCommand(command, { id: newId, name: newName });
                        inputId.value = '';
                        inputName.value = '';
                    };
                    addSection.appendChild(addBtn);

                    card.appendChild(addSection);
                    container.appendChild(card);
                }
            }

            // Ø­Ø°Ù Ø±ÙˆÙ„ Ù…Ù† Ø£Ù…Ø±
            async function removeRoleFromCommand(command, roleId) {
                try {
                    let roles = rulesData[command];
                    roles = roles.filter(r => r.id !== roleId);
                    await fetch(`/api/rules/${command}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ roles }),
                    });
                    await reloadRules();
                } catch {
                    alert('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø±ÙˆÙ„');
                }
            }

            // Ø¥Ø¶Ø§ÙØ© Ø±ÙˆÙ„ Ù„Ø£Ù…Ø±
            async function addRoleToCommand(command, role) {
                try {
                    let roles = rulesData[command] || [];
                    if (roles.find(r => r.id === role.id)) {
                        alert('Ø§Ù„Ø±ÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø±');
                        return;
                    }
                    roles.push(role);
                    await fetch(`/api/rules/${command}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ roles }),
                    });
                    await reloadRules();
                } catch {
                    alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ÙˆÙ„');
                }
            }

            async function reloadRules() {
                const resp = await fetch('/api/rules');
                rulesData = await resp.json();
                renderRules();
            }

            // ØªØ´ØºÙŠÙ„ ÙˆØ¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØª
            document.getElementById('stop-bot').addEventListener('click', async () => {
                if (configData.botStatus === 'stopped') {
                    alert('Ø§Ù„Ø¨ÙˆØª Ù…ØªÙˆÙ‚Ù Ø¨Ø§Ù„ÙØ¹Ù„.');
                    return;
                }
                if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØªØŸ')) return;
                await toggleBotStatus('stopped');
                window.location.reload(); // âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
            });

            document.getElementById('start-bot').addEventListener('click', async () => {
                if (configData.botStatus === 'running') {
                    alert('Ø§Ù„Ø¨ÙˆØª Ø´ØºØ§Ù„ Ø¨Ø§Ù„ÙØ¹Ù„.');
                    return;
                }
                await toggleBotStatus('running');
                window.location.reload(); // âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
            });
            async function toggleBotStatus(status) {
                try {
                    const resp = await fetch('/api/bot-status', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ status }),
                    });
                    const data = await resp.json();
                    if (!data.success) {
                        alert('ÙØ´Ù„ ÙÙŠ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª');
                    } else {
                        configData.botStatus = status; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§
                    }
                } catch {
                    alert('Ø®Ø·Ø£ ÙÙŠ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª');
                }
            }

            // Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª
            async function fetchBotStatus() {
                try {
                    const resp = await fetch('/api/uptime');
                    const data = await resp.json();

                    const botStatusText = document.getElementById('bot-status-text');
                    botStatusText.textContent = configData.botStatus === 'running' ? 'ØªØ´ØºÙŠÙ„' : 'Ù…ØªÙˆÙ‚Ù';
                    botStatusText.className = configData.botStatus === 'running' ? 'text-success' : 'text-danger';

                    const uptimeSpan = document.getElementById('uptime');
                    uptimeSpan.textContent = msToTime(data.uptime);
                } catch {
                    // ÙÙŠ Ø­Ø§Ù„ ÙØ´Ù„ Ø§Ù„Ø¬Ù„Ø¨ Ù…Ù…ÙƒÙ† ØªØ­Ø· Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ø£Ùˆ ØªØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ©
                }
            }

            // Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¯Ø© Ø¥Ù„Ù‰ Ù†Øµ Ø¨ØµÙŠØº Ù…Ø®ØªÙ„ÙØ©
            function msToTime(duration) {
                let seconds = Math.floor((duration / 1000) % 60),
                    minutes = Math.floor((duration / (1000 * 60)) % 60),
                    hours = Math.floor((duration / (1000 * 60 * 60)) % 24),
                    days = Math.floor(duration / (1000 * 60 * 60 * 24));

                let str = '';
                if (days > 0) str += days + ' ÙŠÙˆÙ… ';
                if (hours > 0) str += hours + ' Ø³Ø§Ø¹Ø© ';
                if (minutes > 0) str += minutes + ' Ø¯Ù‚ÙŠÙ‚Ø© ';
                str += seconds + ' Ø«Ø§Ù†ÙŠØ©';
                return str;
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
            setInterval(fetchBotStatus, 1000);

            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø£ÙˆÙ„ÙŠ
            fetchBotStatus();

            // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©ØŒ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            window.onload = () => {
                fetchData();
            };
        </script>
</body>
</html>